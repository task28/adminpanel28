<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Task Manager</title>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDuxSz3j5xMYDw5U9kLA0cjkpOE82D06MI",
            authDomain: "part-1-f6d87.firebaseapp.com",
            databaseURL: "https://part-1-f6d87-default-rtdb.firebaseio.com",
            projectId: "part-1-f6d87",
            storageBucket: "part-1-f6d87.firebasestorage.app",
            messagingSenderId: "682699403122",
            appId: "1:682699403122:web:038ffca84d489a6c0db7eb"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
    </script>

    <style>
        body { background: #050505; color: #ccc; font-family: 'Montserrat', sans-serif; padding: 20px; }
        .header { display: flex; justify-content: space-between; border-bottom: 2px solid #d4af37; padding-bottom: 15px; margin-bottom: 20px; }
        .title { color: #d4af37; font-family: 'Share Tech Mono', monospace; font-size: 1.5rem; }
        .back-btn { background: #333; color: #fff; border: none; padding: 8px 15px; cursor: pointer; }
        
        .section-title { color: #fff; margin: 20px 0 10px; border-left: 4px solid #d4af37; padding-left: 10px; font-weight: bold; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; }
        .card { background: #111; border: 1px solid #333; padding: 20px; border-radius: 8px; }
        
        .input-group { margin-bottom: 10px; }
        .input-group label { display: block; font-size: 0.7rem; color: #666; }
        .input-group input { width: 100%; background: #000; border: 1px solid #444; color: #fff; padding: 8px; }
        
        .paste-area {
            width: 100%; height: 60px; background: #080808; border: 1px dashed #2ecc71; 
            color: #2ecc71; font-size: 0.7rem; padding: 5px; margin-bottom: 5px; resize: none;
        }
        .btn-autofill {
            width: 100%; background: #222; color: #2ecc71; border: 1px solid #2ecc71; 
            padding: 5px; cursor: pointer; font-size: 0.8rem; margin-bottom: 15px;
        }
        .btn-autofill:hover { background: #2ecc71; color: #000; }

        .data-display { background: #000; padding: 10px; border: 1px dashed #444; margin-bottom: 10px; cursor: pointer; word-break: break-all; }
        .btn-action { width: 100%; padding: 10px; border: none; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .btn-send { background: #d4af37; color: #000; }
        .btn-approve { background: #27ae60; color: #fff; }
        .btn-reject { background: #c0392b; color: #fff; }
        .profit-input { width: 100%; padding: 8px; margin-bottom: 5px; background: #222; border: 1px solid #27ae60; color: #fff; text-align: center; }

        .sound-control {
            font-size: 0.8rem; color: #2ecc71; cursor: pointer; border: 1px solid #2ecc71; padding: 5px 10px; border-radius: 20px;
        }
    </style>
</head>
<body>
<div class="header">
    <div class="title">TASK MANAGER</div>
    <div style="display: flex; gap: 10px; align-items: center;">
        <div class="sound-control" onclick="testVoice()"><i class="fas fa-volume-up"></i> Test Voice</div>
        <button class="back-btn" onclick="window.location.href='Admin_home.html'">BACK</button>
    </div>
</div>

<div class="section-title">PENDING REQUESTS</div>
<div class="grid-container" id="pending_list">Loading...</div>

<div class="section-title">SUBMITTED FOR REVIEW</div>
<div class="grid-container" id="review_list">Loading...</div>

<script>
    let lastPendingCount = -1;
    let lastReviewCount = -1;

    // --- AUTH CHECK ---
    const sessionAuth = sessionStorage.getItem("admin_access");
    if (sessionAuth === "granted") {
        initPage();
    } else {
        auth.onAuthStateChanged(user => {
            if(user && user.email === "rafsanvai388@gmail.com") {
                initPage();
            } else {
                window.location.href = "index.html";
            }
        });
    }

    function initPage() {
        loadPending();
        loadReview();
    }

    // --- VOICE ---
    function speak(text) {
        if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.pitch = 1; utterance.rate = 1;
            window.speechSynthesis.speak(utterance);
        }
    }
    function testVoice() { speak("Voice Notification System Active"); }

    // 1. PENDING LOAD
    function loadPending() {
        db.ref('tasks').orderByChild('status').equalTo('pending').on('value', snap => {
            const list = document.getElementById('pending_list');
            list.innerHTML = "";
            
            const currentCount = snap.numChildren();
            if (lastPendingCount !== -1 && currentCount > lastPendingCount) speak("New Task Request Received");
            lastPendingCount = currentCount;

            if(!snap.exists()) { list.innerHTML = "<p>No pending requests.</p>"; lastPendingCount = 0; return; }

            snap.forEach(child => {
                const uid = child.key;
                list.innerHTML += `
                    <div class="card">
                        <div style="color:#d4af37; margin
