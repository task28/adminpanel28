<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin - User Details</title>
    <style>
        body { background: #222; color: #ddd; font-family: monospace; padding: 20px; }
        input { width: 100%; padding: 10px; background: #000; color: white; border: 1px solid #555; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #555; padding: 8px; text-align: left; }
        th { background: #444; }
    </style>
</head>
<body>
    <h1>User Details</h1>
    <input type="text" id="searchInput" onkeyup="search()" placeholder="Search by name or number...">
    
    <table id="userTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Balance</th>
                <th>Referral Code</th>
                <th>Pass</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
        
        const firebaseConfig = { apiKey: "AIzaSyB2YLhAvSF12ZZx7LSnbqcCjtS2_8QLt4o", authDomain: "task-f6078.firebaseapp.com", databaseURL: "https://task-f6078-default-rtdb.firebaseio.com", projectId: "task-f6078", storageBucket: "task-f6078.firebasestorage.app", messagingSenderId: "887907470692", appId: "1:887907470692:web:c4142ac9573e19d29d3e71" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        if(!sessionStorage.getItem('admin')) window.location.href = 'index.html';

        let users = [];

        onValue(ref(db, 'users'), snapshot => {
            const tbody = document.getElementById('tbody');
            tbody.innerHTML = "";
            users = [];
            
            snapshot.forEach(child => {
                const u = child.val();
                users.push(u);
                renderRow(u);
            });
        });

        function renderRow(u) {
            const tbody = document.getElementById('tbody');
            tbody.innerHTML += `
                <tr>
                    <td>${u.name}</td>
                    <td>${u.phone}</td>
                    <td style="color:yellow">${u.balance}</td>
                    <td>${u.referralCode}</td>
                    <td>${u.password}</td>
                </tr>`;
        }

        window.search = () => {
            const term = document.getElementById('searchInput').value.toLowerCase();
            document.getElementById('tbody').innerHTML = "";
            users.forEach(u => {
                if(u.name.toLowerCase().includes(term) || u.phone.includes(term)){
                    renderRow(u);
                }
            });
        };
    </script>
</body>
</html>
